# Circuits

Circuits is a full-stack FastAPI + Vue application for creating, editing, and running timeboxed training circuits. A Vue 3 single-page application powers the user experience while the FastAPI backend persists data in SQLite and exposes a JSON API.

## Features

- 📚 **Circuit library** – Store named circuits with ordered tasks that include names, descriptions, and durations.
- 🧱 **Vue-powered builder** – Create and edit circuits with an interactive Vue form that manages tasks dynamically.
- 📄 **JSON schema export** – Visit `/api/circuit-schema` to retrieve a JSON Schema plus an example payload.
- ⏱️ **Guided runner** – Walk through each task with an inline timer, pause/resume controls, and task status indicators.
- 💾 **Local persistence** – All data is stored in `circuits.db` using SQLite.

## Project layout

```
app/
├── main.py              # FastAPI application and routes
├── models.py            # SQLModel definitions
├── database.py          # SQLite engine helpers
├── templates/           # Legacy Jinja templates
└── static/              # Built Vue assets (generated by Vite)
frontend/
├── src/                 # Vue 3 source code
├── index.html           # Vite entry
├── package.json         # Frontend dependencies
└── vite.config.js       # Vite configuration (outputs to app/static)
```

## Running locally

The repository provides a convenience script that bootstraps Python dependencies, installs the frontend toolchain, builds the Vue application, and launches the development server:

```bash
./setup.sh
```

The application becomes available at <http://127.0.0.1:8000>. The first run creates `circuits.db` in the project root.

### Manual setup

If you prefer to manage the environment yourself:

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
(cd frontend && npm install && npm run build)
uvicorn app.main:app --reload
```

## Docker

Build and run the container with Docker Compose:

```bash
docker compose up --build
```

The multi-stage Docker build compiles the Vue SPA and copies the generated assets into the FastAPI image. This maps the service to <http://localhost:8000> and persists `circuits.db` to the host.

## JSON schema

The circuit schema is available at <http://localhost:8000/api/circuit-schema>:

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Circuit",
  "type": "object",
  "required": ["name", "tasks"],
  "properties": {
    "name": {"type": "string"},
    "description": {"type": "string"},
    "tasks": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "duration"],
        "properties": {
          "name": {"type": "string"},
          "description": {"type": "string"},
          "duration": {"type": "integer", "minimum": 1}
        }
      }
    }
  }
}
```

Use this document to validate payloads or guide automated agents that generate circuits.
